# ðŸ–Œï¸ Android Canvas ì •ë¦¬

## ðŸ“˜ ê°œìš”

`Canvas`ëŠ” Androidì—ì„œ **2D ê·¸ëž˜í”½ì„ ê·¸ë¦¬ê¸° ìœ„í•œ ë„í™”ì§€ ì—­í• ì˜ ê°ì²´**ìž…ë‹ˆë‹¤.

Viewë‚˜ Bitmap ë“± â€œê·¸ë¦´ ëŒ€ìƒ(Render Target)â€ ìœ„ì— ë„í˜•, ì´ë¯¸ì§€, í…ìŠ¤íŠ¸ë¥¼ í‘œí˜„í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

ëª¨ë“  ê·¸ë¦¬ê¸° ëª…ë ¹(`drawXXX`)ì€ **C++ Skia ì—”ì§„ì˜ `SkCanvas`** ë¥¼ í†µí•´ ì‹¤ì œ í”½ì…€ ë‹¨ìœ„ë¡œ ìˆ˜í–‰ë˜ë©°,

`Paint`ëŠ” ì´ë•Œ ì‚¬ìš©ë˜ëŠ” â€œë¶“â€ìœ¼ë¡œì„œ ìƒ‰ìƒ, êµµê¸°, ìŠ¤íƒ€ì¼ ë“±ì˜ ì†ì„±ì„ ì •ì˜í•©ë‹ˆë‹¤.

> âœ… CanvasëŠ” ê·¸ë¦¼ì´ ê·¸ë ¤ì§€ëŠ” ê³µê°„(ë„í™”ì§€)
> 
> 
> âœ… **PaintëŠ” ê·¸ë¦¼ì„ ê·¸ë¦¬ëŠ” ë„êµ¬(ë¶“ê³¼ ë¬¼ê°)**
> 
> âœ… **View / Bitmapì€ ë„í™”ì§€ë¥¼ ê±¸ì–´ë†“ëŠ” ì•¡ìž(ê²°ê³¼ë¬¼ì˜ í‹€)**
> 

---

## ðŸ§© Canvasì˜ ì—­í• 

| ì—­í•  | ì„¤ëª… |
| --- | --- |
| **ë„í™”ì§€ ì—­í• ** | Viewë‚˜ Bitmap ìœ„ì— ì‹¤ì œ í”½ì…€ì„ ê·¸ë¦´ ìˆ˜ ìžˆëŠ” ê³µê°„ ì œê³µ |
| **ì¢Œí‘œê³„ ê´€ë¦¬** | íšŒì „(`rotate`), ì´ë™(`translate`), í¬ê¸° ì¡°ì •(`scale`) ë“±ì˜ ë³€í™˜ ê´€ë¦¬ |
| **ê·¸ë¦¬ê¸° ëª…ë ¹ ìˆ˜í–‰** | `drawRect`, `drawCircle`, `drawBitmap`, `drawText` ë“± Skia í˜¸ì¶œ |
| **í´ë¦¬í•‘ ê´€ë¦¬** | `clipRect`, `clipPath`ë¡œ ê·¸ë¦´ ìˆ˜ ìžˆëŠ” ì˜ì—­ ì œì–´ |
| **ìƒíƒœ ì €ìž¥/ë³µì›** | `save()` / `restore()`ë¡œ Canvasì˜ ë³€í™˜ ìƒíƒœë¥¼ ìŠ¤íƒ ê¸°ë°˜ìœ¼ë¡œ ê´€ë¦¬ |

---

## âš™ï¸ ë‚´ë¶€ êµ¬í˜„ êµ¬ì¡°

`Canvas`ëŠ” Java ë ˆë²¨ì˜ í´ëž˜ìŠ¤ì§€ë§Œ, ë‚´ë¶€ì ìœ¼ë¡œ **C++ Skia ì—”ì§„ ê°ì²´(`SkCanvas`)** ë¥¼ ê°ì‹¸ê³  ìžˆìŠµë‹ˆë‹¤.

```java
public class Canvas {
    // Skiaì˜ SkCanvas ê°ì²´ë¥¼ ê°€ë¦¬í‚¤ëŠ” Native í¬ì¸í„°
    final long mNativeCanvasWrapper;
}
```

### JNI ë¸Œë¦¬ì§€ êµ¬ì¡°

| ê³„ì¸µ | í´ëž˜ìŠ¤ | ì—­í•  |
| --- | --- | --- |
| Java | `android.graphics.Canvas` | ê°œë°œìžê°€ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” API |
| JNI | `android_graphics_Canvas.cpp` | Java â†’ C++ ë¸Œë¦¬ì§€ |
| C++ | `SkCanvas` | ì‹¤ì œ ê·¸ë¦¬ê¸° ìˆ˜í–‰ (í”½ì…€ ì—°ì‚°, GPU ëª…ë ¹ ê¸°ë¡ ë“±) |
| C++ | `SkPaint`, `SkPath`, `SkBitmap` | ìƒ‰ìƒ, ê²½ë¡œ, í”½ì…€ ë°ì´í„° ê´€ë¦¬ |

> ì¦‰, canvas.drawRect() â†’ JNI â†’ SkCanvas::drawRect() â†’ Skia ë Œë”ë§ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰.
> 

---

## ðŸ§  Canvasì˜ ë™ìž‘ ì›ë¦¬

CanvasëŠ” ë‹¨ë…ìœ¼ë¡œ ì¡´ìž¬í•˜ì§€ ì•Šê³ ,

**â€œë¬´ì—‡ì„ ê·¸ë¦´ì§€â€** (Canvas ëª…ë ¹) ì™€ **â€œì–´ë””ì— ê·¸ë¦´ì§€â€** (Render Target) ë¥¼ í•¨ê»˜ ê´€ë¦¬í•©ë‹ˆë‹¤.

ë Œë” ëŒ€ìƒì— ë”°ë¼ CanvasëŠ” ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤ ðŸ‘‡

| êµ¬ë¶„ | Viewìš© Canvas | Bitmapìš© Canvas |
| --- | --- | --- |
| **ë Œë” ëŒ€ìƒ** | í™”ë©´ Surface (GPU) | ë©”ëª¨ë¦¬ Bitmap (CPU) |
| **ìƒì„± ì£¼ì²´** | ViewRootImpl / HardwareRenderer | ê°œë°œìž ì§ì ‘ ìƒì„± |
| **ìˆ˜ëª…** | í”„ë ˆìž„ ë‹¨ìœ„ (invalidate â†’ draw) | ê°œë°œìž ì œì–´ |
| **ê·¸ë¦¼ ì €ìž¥ ìœ„ì¹˜** | GPU ëª…ë ¹ ë²„í¼ | SkBitmap í”½ì…€ ë²„í¼ |
| **ëŒ€í‘œ êµ¬í˜„ì²´** | `RecordingCanvas` / `DisplayListCanvas` | `SkiaCanvas` |

---

## ðŸ§± ë‚´ë¶€ ë Œë”ë§ íë¦„

### ðŸ–¼ï¸ Viewì—ì„œì˜ ë Œë”ë§

```
invalidate()
   â†“
ViewRootImpl.performDraw()
   â†“
HardwareRenderer.beginRecording()
   â†“
Canvas ìƒì„± (RecordingCanvas)
   â†“
View.draw(Canvas)
   â†“
View.onDraw(Canvas)
   â†“
HardwareRenderer.endRecording()
   â†“
GPU ëª…ë ¹ â†’ SurfaceFlinger â†’ í™”ë©´ í‘œì‹œ
```

- `Canvas`ëŠ” GPU ëª…ë ¹ ë²„í¼ì— ê¸°ë¡ë˜ëŠ” **ë„í™”ì§€ ì—­í• **
- `Paint`ëŠ” ê·¸ë¦´ ì†ì„± ì •ì˜
- ì‹¤ì œ í”½ì…€ì€ Surfaceì— ì¶œë ¥

---

### ðŸ§© Bitmapì—ì„œì˜ ë Œë”ë§

```kotlin
val bitmap = Bitmap.createBitmap(200, 200, Bitmap.Config.ARGB_8888)
val canvas = Canvas(bitmap)
canvas.drawCircle(100f, 100f, 80f, paint)
imageView.setImageBitmap(bitmap)
```

- `Canvas(bitmap)`ì„ í˜¸ì¶œí•˜ë©´, Skiaì˜ `SkCanvas`ê°€ `SkBitmap`ì„ ê·¸ë¦´ ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš©
- í”½ì…€ ì—°ì‚°ì€ GPUê°€ ì•„ë‹Œ **CPU ë©”ëª¨ë¦¬ ë²„í¼(Skia Bitmap)** ì—ì„œ ìˆ˜í–‰
- ê²°ê³¼ëŠ” Bitmap ê°ì²´ì— ì €ìž¥ë˜ì–´ ì´í›„ `ImageView` ë“±ì—ì„œ í‘œì‹œ ê°€ëŠ¥

---

## ðŸ§® Skia ê¸°ë°˜ ë‚´ë¶€ êµ¬ì¡°

```
Java Heap
 â”œâ”€â”€ Canvas (mNativeCanvasWrapper)
 â”œâ”€â”€ Paint, Path, Bitmap wrapper
 â””â”€â”€ JNI reference â†’ Native pointer
        â†“
Native Heap (C++)
 â”œâ”€â”€ SkCanvas (ë„í™”ì§€)
 â”œâ”€â”€ SkPaint (ë¶“ê³¼ ìƒ‰ìƒ)
 â”œâ”€â”€ SkBitmap / SkSurface (í”½ì…€ ë²„í¼)
 â””â”€â”€ GPU ëª…ë ¹ ë²„í¼ (í•˜ë“œì›¨ì–´ ê°€ì† ì‹œ)
```

### ì£¼ìš” ê°ì²´ë³„ ì—­í• 

| ê°ì²´ | ì—­í•  |
| --- | --- |
| **SkCanvas** | í”½ì…€ì„ ê·¸ë¦´ ìˆ˜ ìžˆëŠ” ë„í™”ì§€, ëª¨ë“  ê·¸ë¦¬ê¸° ëª…ë ¹ì„ ì²˜ë¦¬ |
| **SkPaint** | ë¶“ì˜ ì†ì„± (ìƒ‰ìƒ, Stroke, Shader, BlendMode ë“±) |
| **SkPath** | ê·¸ë¦´ ê²½ë¡œ (ê³¡ì„ , ë‹¤ê°í˜• ë“±) |
| **SkBitmap / SkSurface** | ì‹¤ì œ í”½ì…€ì´ ì €ìž¥ë˜ëŠ” ë²„í¼ (CPU or GPU) |

---

## âš¡ Canvasì˜ ì£¼ìš” í•¨ìˆ˜

| í•¨ìˆ˜ | ì—­í•  |
| --- | --- |
| `drawRect()`, `drawCircle()`, `drawLine()` | ê¸°ë³¸ ë„í˜• ê·¸ë¦¬ê¸° |
| `drawBitmap()` | ë¹„íŠ¸ë§µ ì´ë¯¸ì§€ ë Œë”ë§ |
| `drawText()` | í…ìŠ¤íŠ¸ ê·¸ë¦¬ê¸° |
| `save()` / `restore()` | ìƒíƒœ ì €ìž¥ ë° ë³µì› |
| `translate()`, `rotate()`, `scale()` | ì¢Œí‘œê³„ ë³€í™˜ |
| `clipRect()`, `clipPath()` | ê·¸ë¦¬ê¸° ì˜ì—­ ì œí•œ |

---

## ðŸ’¡ Viewì™€ Bitmapì—ì„œì˜ ê´€ê³„ ìš”ì•½

| êµ¬ë¶„ | View Canvas | Bitmap Canvas |
| --- | --- | --- |
| **ë Œë” ëŒ€ìƒ** | Surface (í™”ë©´ ë²„í¼) | Bitmap (ë©”ëª¨ë¦¬ ë²„í¼) |
| **ë Œë”ë§ ë°©ì‹** | GPU ê¸°ë°˜ | CPU ê¸°ë°˜ |
| **Canvas ìƒì„± ì‹œì ** | ViewRootImpl â†’ onDraw | ê°œë°œìž ì§ì ‘ ìƒì„± |
| **ìš©ë„** | í™”ë©´ ë Œë”ë§, UI ê·¸ë¦¬ê¸° | ì˜¤í”„ìŠ¤í¬ë¦° ë Œë”ë§, ì´ë¯¸ì§€ í•©ì„±, ì¸ë„¤ì¼ |
| **ê²°ê³¼ë¬¼** | í™”ë©´ì— ì¦‰ì‹œ í‘œì‹œ | Bitmap ê°ì²´ë¡œ ë©”ëª¨ë¦¬ì— ë³´ê´€ |

---

## âœ… ê²°ë¡  ìš”ì•½

| í•­ëª© | ì„¤ëª… |
| --- | --- |
| **Canvasì˜ ë³¸ì§ˆ** | Skia ì—”ì§„ ìœ„ì—ì„œ ë™ìž‘í•˜ëŠ” â€œê·¸ë¦¼ì„ ê·¸ë¦¬ëŠ” ê³µê°„â€ |
| **ë‚´ë¶€ êµ¬í˜„** | Java â†” JNI â†” SkCanvas(C++) êµ¬ì¡° |
| **Render Target** | View(Surface) ë˜ëŠ” Bitmap(SkBitmap) |
| **Paintì˜ ì—­í• ** | Canvas ìœ„ì— ìƒ‰ìƒÂ·ì„ Â·ìŠ¤íƒ€ì¼ì„ ìž…ížˆëŠ” ë„êµ¬ |
| **ë Œë”ë§ ë°©ì‹** | View: GPU / Bitmap: CPU |
| **ë©”ëª¨ë¦¬ ê´€ë¦¬** | ì‹œìŠ¤í…œ ìžë™ ê´€ë¦¬ (Native ìžì›ì€ Renderer í•´ì œ) |
| **í•µì‹¬ êµ¬ë¶„** | CanvasëŠ” â€œë„í™”ì§€â€, PaintëŠ” â€œë¶“â€, View/Bitmapì€ â€œê·¸ë¦¼ì„ ê±¸ì–´ë‘ëŠ” í‹€â€ |

---

## ðŸ’¬ í•œ ì¤„ ìš”ì•½

> CanvasëŠ” Skia ì—”ì§„ì„ í†µí•´ Viewë‚˜ Bitmap ìœ„ì— ê·¸ë¦¼ì„ ê·¸ë¦¬ëŠ” ë„í™”ì§€ì´ë©°,
> 
> 
> ë‚´ë¶€ì ìœ¼ë¡œ í”½ì…€ ë Œë”ë§ì€ C++ì˜ `SkCanvas`ê°€ ìˆ˜í–‰í•œë‹¤.
> 
> `Paint`ëŠ” ê·¸ ë„í™”ì§€ ìœ„ì—ì„œ ìƒ‰ê³¼ ìŠ¤íƒ€ì¼ì„ ì •í•˜ëŠ” ë¶“ ì—­í• ì„ í•œë‹¤. ðŸŽ¨
>
